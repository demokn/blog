<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Java 碎片化知识点</title>
<meta name="keywords" content="珊瑚礁上的程序员, Java" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="https://demokn.github.io/blog/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://demokn.github.io/blog/assets/lib/twitter-bootstrap/4.4.1/bootstrap.min.css">
<link rel="stylesheet" href="https://demokn.github.io/blog/assets/lib/font-awesome/5.12.1/all.min.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=ZCOOL+KuaiLe|Amaranth|Handlee|Libre+Baskerville|Bree+Serif|Ubuntu+Mono|Pacifico&subset=latin,greek"/>
<link rel="stylesheet" href="https://demokn.github.io/blog/assets/css/site.css">
<link rel="stylesheet" href="https://demokn.github.io/blog/assets/css/highlight.css">
</head>
<body>
<div class="content-wrapper container">
<div class="row">
<div class="col-lg-8 col-md-10 mx-auto">

<div id="preamble" class="status">
<div class="banner">
  <a href="/" style="font-family: 'ZCOOL KuaiLe', cursive;"> 珊瑚礁上的程序员 </a>
</div>
<ul class="banner-links">
  <li><a href="https://demokn.github.io/blog/posts/archive.html"> Archive </a></li>
  <li><a href="https://demokn.github.io/blog/posts/rss.xml"> RSS </a></li>
  <li><a href="https://demokn.github.io/blog/about.html"> About </a></li>
</ul>
<hr>
</div>
<div id="article" class="content">
<header>
<h1 class="title">Java 碎片化知识点</h1>
<p class="subtitle" role="doc-subtitle">发布于 2023-08-25</p>
</header>
<section id="outline-container-org8cd9918" class="outline-2">
<h2 id="org8cd9918">获取当前时间戳</h2>
<div class="outline-text-2" id="text-org8cd9918">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">time</span>.<span class="org-type">Instant</span>;

<span class="org-comment-delimiter">//</span><span class="org-comment">10&#20301;&#26102;&#38388;&#25139;, 1692893144</span>
<span class="org-type">long</span> <span class="org-variable-name">epochSecond</span> = Instant.now().getEpochSecond();
<span class="org-comment-delimiter">//</span><span class="org-comment">10&#20301;&#26102;&#38388;&#25139;, &#25972;&#22411;, 1692893144</span>
<span class="org-type">int</span> <span class="org-variable-name">epochSecond1</span> = (<span class="org-type">int</span>) Instant.now().getEpochSecond();
<span class="org-comment-delimiter">//</span><span class="org-comment">13&#20301;&#26102;&#38388;&#25139;, 1692893144845</span>
<span class="org-type">long</span> <span class="org-variable-name">epochMilli</span> = Instant.now().toEpochMilli();
<span class="org-comment-delimiter">//</span><span class="org-comment">13&#20301;&#26102;&#38388;&#25139;, 1692893144845</span>
<span class="org-type">long</span> <span class="org-variable-name">currentTimeMillis</span> = System.currentTimeMillis();
</pre>
</div>
</div>
</section>

<section id="outline-container-org49172fd" class="outline-2">
<h2 id="org49172fd">时间戳转 <code>LocalDateTime</code></h2>
<div class="outline-text-2" id="text-org49172fd">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">time</span>.<span class="org-type">Instant</span>;
<span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">time</span>.<span class="org-type">LocalDateTime</span>;
<span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">time</span>.<span class="org-type">ZoneId</span>;

<span class="org-type">LocalDateTime</span> <span class="org-variable-name">localDateTime</span> = Instant.ofEpochSecond(1692893364).atZone(ZoneId.systemDefault()).toLocalDateTime();
<span class="org-type">LocalDateTime</span> <span class="org-variable-name">localDateTime1</span> = LocalDateTime.ofInstant(Instant.ofEpochSecond(1692893364), ZoneId.systemDefault());
<span class="org-type">LocalDateTime</span> <span class="org-variable-name">localDateTime2</span> = Instant.ofEpochMilli(1692893364596L).atZone(ZoneId.systemDefault()).toLocalDateTime();
<span class="org-type">LocalDateTime</span> <span class="org-variable-name">localDateTime3</span> = LocalDateTime.ofInstant(Instant.ofEpochMilli(1692893364596L), ZoneId.systemDefault());
</pre>
</div>
</div>
</section>

<section id="outline-container-org3a6fe58" class="outline-2">
<h2 id="org3a6fe58">格式化 <code>LocalDateTime</code></h2>
<div class="outline-text-2" id="text-org3a6fe58">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">time</span>.<span class="org-type">LocalDateTime</span>;
<span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">time</span>.<span class="org-constant">format</span>.<span class="org-type">DateTimeFormatter</span>;

<span class="org-comment-delimiter">//</span><span class="org-comment">2023-08-25 00:20:53</span>
<span class="org-comment-delimiter">//</span><span class="org-comment">java8 &#25512;&#33616;&#20351;&#29992; DateTimeFormatter &#26469;&#26684;&#24335;&#21270;</span>
<span class="org-type">String</span> <span class="org-variable-name">format</span> = LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="org-string">"yyyy-MM-dd HH:mm:ss"</span>));
</pre>
</div>
</div>
</section>

<section id="outline-container-org67179da" class="outline-2">
<h2 id="org67179da">枚举类之间的相互依赖问题</h2>
<div class="outline-text-2" id="text-org67179da">
<p>
场景是，目前项目中已经有一个书籍的枚举类 <code>BookEnum</code> （此处为代指），现在有新的需求需要为书籍增加分类。
最简单的做法是在 <code>BookEnum</code> 中新增一个 <code>private String category</code> 字段来表示类别。
但这样存在的问题是:
</p>

<ol class="org-ol">
<li>分类都是字符串，同一个分类需要重复定义</li>
<li>后续如果继续还要给书籍增加属性，还要继续扩展这个 <code>BookEnum</code> 枚举类，会造成越来越臃肿</li>
</ol>

<p>
基于上述 2 点，现考虑新增一个表示类别的枚举类 <code>CategoryEnum</code> 。
书籍和分类的关系维护在 <code>CategoryEnum</code> 枚举类中。
同时 <code>需要保证每本书都要定义所属类别，且, 有且只能有一个类别</code> 。
</p>

<p>
具体代码实现如下：
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Main</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        System.out.println(<span class="org-string">"Main&#26041;&#27861;--&#24320;&#22987;"</span>);
        System.out.println(<span class="org-string">"BookEnum.B1&#26159;&#21542;&#23450;&#20041;&#20102;&#24402;&#23646;&#31867;&#21035;: "</span> + CategoryEnum.defined(<span class="org-constant">BookEnum</span>.B1));
        System.out.println(<span class="org-string">"Main&#26041;&#27861;--&#32467;&#26463;"</span>);
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">enum</span> <span class="org-type">BookEnum</span> {

    <span class="org-function-name">B1</span>(<span class="org-string">"Book1"</span>),
    <span class="org-function-name">B2</span>(<span class="org-string">"Book2"</span>),
    ;

    <span class="org-keyword">private</span> <span class="org-keyword">final</span> <span class="org-type">String</span> <span class="org-variable-name">code</span>;
    <span class="org-keyword">private</span> <span class="org-keyword">final</span> <span class="org-type">String</span> <span class="org-variable-name">desc</span>;

    <span class="org-keyword">static</span> {
        System.out.println(<span class="org-string">"BookEnum &#38745;&#24577;&#20195;&#30721;&#22359;--&#24320;&#22987;"</span>);
        System.out.println(<span class="org-string">"BookEnum &#38745;&#24577;&#20195;&#30721;&#22359;--&#32467;&#26463;"</span>);
    }

    BookEnum(<span class="org-type">String</span> <span class="org-variable-name">desc</span>) {
        <span class="org-keyword">this</span>.code = name();
        <span class="org-keyword">this</span>.desc = desc;
        System.out.println(<span class="org-string">"BookEnum &#26500;&#36896;&#20989;&#25968;"</span> + code);
    }

    <span class="org-keyword">public</span> <span class="org-type">String</span> <span class="org-function-name">getCode</span>() {
        <span class="org-keyword">return</span> code;
    }

    <span class="org-keyword">public</span> <span class="org-type">String</span> <span class="org-function-name">getDesc</span>() {
        <span class="org-keyword">return</span> desc;
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">util</span>.*;
<span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">util</span>.<span class="org-constant">concurrent</span>.<span class="org-type">ConcurrentHashMap</span>;

<span class="org-keyword">public</span> <span class="org-keyword">enum</span> <span class="org-type">CategoryEnum</span> {

    <span class="org-function-name">C1</span>(<span class="org-string">"CAT1"</span>, Arrays.asList(<span class="org-constant">BookEnum</span>.B1)),
    <span class="org-function-name">C2</span>(<span class="org-string">"CAT2"</span>, Arrays.asList(<span class="org-constant">BookEnum</span>.B2)), <span class="org-comment-delimiter">//</span><span class="org-comment">&#22914;&#26524;&#27880;&#37322;&#25481;&#35813;&#34892;&#20195;&#30721;, &#20250;&#22240;&#20026;BookEnum.B2&#27809;&#26377;&#23450;&#20041;&#25152;&#23646;Category&#32780;&#25243;&#20986;&#24322;&#24120;</span>
    <span class="org-comment-delimiter">//</span><span class="org-comment">C3("CAT3", Arrays.asList(BookEnum.B2)), //&#22914;&#26524;&#25171;&#24320;&#35813;&#34892;&#27880;&#37322;, &#20250;&#22240;&#20026;BookEnum.B2&#21516;&#26102;&#24402;&#23646;&#20110;&#20004;&#20010;Category&#32780;&#25243;&#20986;&#24322;&#24120;</span>
    ;

    <span class="org-keyword">private</span> <span class="org-keyword">final</span> <span class="org-type">String</span> <span class="org-variable-name">code</span>;
    <span class="org-keyword">private</span> <span class="org-keyword">final</span> <span class="org-type">String</span> <span class="org-variable-name">desc</span>;
    <span class="org-keyword">private</span> <span class="org-keyword">final</span> <span class="org-type">Set</span>&lt;<span class="org-type">BookEnum</span>&gt; <span class="org-variable-name">types</span>;

    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">Map</span>&lt;<span class="org-type">BookEnum</span>, <span class="org-type">CategoryEnum</span>&gt; <span class="org-variable-name">BOOK_CATEGORY_MAPPING</span> = <span class="org-keyword">new</span> <span class="org-type">ConcurrentHashMap</span>&lt;&gt;();

    <span class="org-keyword">static</span> {
        System.out.println(<span class="org-string">"CategoryEnum &#38745;&#24577;&#20195;&#30721;&#22359;--&#24320;&#22987;"</span>);
        initializeBookCategoryMap();
        System.out.println(<span class="org-string">"CategoryEnum &#38745;&#24577;&#20195;&#30721;&#22359;--&#32467;&#26463;"</span>);
    }

    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">initializeBookCategoryMap</span>() {
        <span class="org-keyword">for</span> (<span class="org-type">CategoryEnum</span> <span class="org-variable-name">category</span> : CategoryEnum.values()) {
            <span class="org-keyword">for</span> (<span class="org-type">BookEnum</span> <span class="org-variable-name">book</span> : category.getTypes()) {
                <span class="org-keyword">if</span> (defined(book)) {
                    <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">RuntimeException</span>(<span class="org-string">"&#37325;&#22797;&#23450;&#20041;&#25152;&#23646;&#31867;&#21035;: "</span> + book.getCode());
                }
                BOOK_CATEGORY_MAPPING.put(book, category);
            }
        }

        <span class="org-keyword">for</span> (<span class="org-type">BookEnum</span> <span class="org-variable-name">book</span> : BookEnum.values()) {
            <span class="org-keyword">if</span> (<span class="org-negation-char">!</span>defined(book)) {
                <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">RuntimeException</span>(<span class="org-string">"&#26410;&#23450;&#20041;&#25152;&#23646;&#31867;&#21035;&#65306;"</span> + book.getCode());
            }
        }
    }

    CategoryEnum(<span class="org-type">String</span> <span class="org-variable-name">desc</span>, <span class="org-type">List</span>&lt;<span class="org-type">BookEnum</span>&gt; <span class="org-variable-name">types</span>) {
        <span class="org-keyword">this</span>.code = name();
        <span class="org-keyword">this</span>.desc = desc;
        <span class="org-keyword">this</span>.types = <span class="org-keyword">new</span> <span class="org-type">HashSet</span>&lt;&gt;(types);
        System.out.println(<span class="org-string">"CategoryEnum &#26500;&#36896;&#20989;&#25968;"</span> + code);
    }

    <span class="org-keyword">public</span> <span class="org-type">String</span> <span class="org-function-name">getCode</span>() {
        <span class="org-keyword">return</span> code;
    }

    <span class="org-keyword">public</span> <span class="org-type">String</span> <span class="org-function-name">getDesc</span>() {
        <span class="org-keyword">return</span> desc;
    }

    <span class="org-keyword">public</span> <span class="org-type">Set</span>&lt;<span class="org-type">BookEnum</span>&gt; <span class="org-function-name">getTypes</span>() {
        <span class="org-keyword">return</span> types;
    }

    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">boolean</span> <span class="org-function-name">defined</span>(<span class="org-type">BookEnum</span> <span class="org-variable-name">bookEnum</span>) {
        <span class="org-keyword">return</span> BOOK_CATEGORY_MAPPING.containsKey(bookEnum);
    }
}
</pre>
</div>

<p>
执行 Main 方法的输出为：
</p>

<pre class="example" id="orgb9cf21f">
Main方法--开始
BookEnum 构造函数B1
BookEnum 构造函数B2
BookEnum 静态代码块--开始
BookEnum 静态代码块--结束
CategoryEnum 构造函数C1
CategoryEnum 构造函数C2
CategoryEnum 静态代码块--开始
CategoryEnum 静态代码块--结束
BookEnum.B1是否定义了归属类别: true
Main方法--结束
</pre>
</div>
</section>
</div>
<div id="postamble" class="status">
<footer class="footer">
  <a href="https://github.com/demokn/blog">
    <p>
      Built with <img id="i-orgmode" src="https://demokn.github.io/blog/assets/images/orgmode.svg"/> in <img id="i-emacs" src="https://demokn.github.io/blog/assets/images/emacs.svg"/>
      <span id="view-source-link"> View Source </span>
    </p>
  </a>
</footer>
</div>
<div id="disqus_thread"></div>
<script>
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://coral-reef.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>
</div>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92899354-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92899354-1');
</script>
<!-- Default Statcounter code -->
<script type="text/javascript">
var sc_project=11272126;
var sc_invisible=1;
var sc_security="cc0cb8d5";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/11272126/0/cc0cb8d5/1/"
alt="Web Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->
</body>
</html>
