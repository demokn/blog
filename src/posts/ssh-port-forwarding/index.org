#+TITLE: SSH 端口转发应用实例
#+KEYWORDS: 珊瑚礁上的程序员, ssh 端口转发, ssh port forwading
#+DATE: <2020-06-08 Mon 18:30>

公司项目使用的阿里云服务，出于安全考虑，数据库服务器仅开放了内网访问权限。
要想使用本地 Mysql 客户端连接公司数据库的话，就需要使用SSH隧道，即先ssh登录云服务器，再连接数据库服务器。
当然一般的 Mysql 客户端都是支持基本的SSH隧道连接的。
但公司的云服务器登录使用了google两步验证，当然也是出于安全考虑了。
而我使用的 Mysql 客户端使用SSH隧道时，尚不支持google两步验证。
这时候，使用SSH本地端口转发就可以很好的解决这个问题。

本地端口转发的命令格式如下：
#+begin_src sh
  ssh -L [<本地主机>:]<本地主机端口>:<远程主机>:<远程主机端口> <SSH登录主机>
#+end_src

在本地电脑上执行如下命令：
#+begin_src sh
  ssh -L 33060:RDS数据库服务器:3306 ECS云服务器
#+end_src

然后使用本地 Mysql 客户端只需要访问本地的33060端口即可。

实际的数据传输流程大致是：
1. 本机的Mysql客户端将数据发送到本机的33060端口上;
2. 本机的SSH客户端将33060端口收到的数据加密并转发到ECS云服务器的SSH服务端;
3. ECS云服务器的SSH服务端收到数据后解密并转发到RDS数据库服务器的3306端口;
4. 最后再将RDS数据库服务器返回的数据原路返回到本机的Mysql客户端。
